<div class="app-content" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
    <div class="app-title">
        <div class="div">
            <h1>
                <i class="fa fa-tablet" aria-hidden="true"></i>
                Asset
            </h1>
        </div>
        <ul class="app-breadcrumb breadcrumb">
            <li class="breadcrumb-item"><a class="fa fa-home fa-lg" (click)="goToDashboard()"></a></li>
            <li class="breadcrumb-item"><span class="breadcrumb-item-router">{{assetTitle}}</span></li>
        </ul>
    </div>

    <div class="row">
        <div class="col-lg-2"></div>
        <div class="col-lg-8 col-sm-12">
            <div class="tile">
                <h3 class="tile-title form-head-line-style">{{assetTitle}}
                </h3>
                <hr>
                <div class="tile-body">
                    <div class="row">
                        <div class="col-sm-6 form-group" *ngIf="!assetId">
                                <label class="control-label">Vendor Ticket Number<b
                                        class="mandatory-field">*</b></label>
                                <ng-select [(ngModel)]="assetQuery.vendorNumber"
                                           [ngModelOptions]="{standalone: true}"
                                           bindValue="value"
                                           bindLabel="key"
                                           placeholder="Select Ticket Number"
                                           [clearable]="false"
                                           (ngModelChange)="getDataForTicketNumber(assetQuery.vendorNumber)"
                                           [ngClass]="currentUser.role === 27 ? 'inactive': ''">
                                    <ng-option value="" selected>Select Ticket Number</ng-option>
                                    <ng-option *ngFor="let ticket of assetTicketNumberList"
                                               [value]="ticket.value">{{ ticket.key }}
                                    </ng-option>
                                </ng-select>
                        </div>
                        <div class="col-sm-6 form-group" *ngIf="assetId">
                            <label class="control-label">Vendor Ticket Number<b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.vendorNumber"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="currentUser.role === 27 ? 'inactive': ''"
                                   placeholder="Asset Category" required />

                        </div>
                        <div class="form-group col-sm-6 text-left">
                            <label class="control-label">Enter Site Name<b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.attrs.siteNames"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Enter Site Name" required/>
<!--                            <ng-select [(ngModel)]="assetQuery.siteId" class="diabled-Drop"-->
<!--                                       [ngModelOptions]="{standalone: true}"-->
<!--                                       bindValue="id"-->
<!--                                       bindLabel="name"-->
<!--                                       placeholder="Select Site"-->
<!--                                       [clearable]="false"-->
<!--                            >-->
<!--                                <ng-option value="" selected>Select Site</ng-option>-->
<!--                                <ng-option *ngFor="let site of sitesStore"-->
<!--                                           [value]="site.id">{{site.name}}</ng-option>-->
<!--                            </ng-select>-->
                        </div>


                        <div class="col-sm-6 form-group">
                            <label class="control-label">Asset Category <b class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.assetCategory"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Asset Category" required/>
                        </div>

                        <div class="col-sm-6 form-group">
                            <label class="control-label">Asset Sub Category <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.assetSubCategory"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Asset Sub Category" required/>
                        </div>

                        <div class="col-sm-6 form-group" > {{assetQuery.vendorName}}
                            <label class="control-label">Vendor Name <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.attrs.vendorName"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29)? 'inactive': ''"
                                   placeholder="Enter Vendor Name" required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Invoice Number <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.invoiceNumber"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Asset Invoice Number" required/>
                        </div>

                        <div class="col-sm-6 form-group">
                            <label class="control-label">Invoice Date <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.invoiceDate"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Asset Invoice Date" required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Asset Identification No <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.indentNumber"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Asset Indent Number" required/>
                        </div>

                        <div class="col-sm-6 form-group">
                            <label class="control-label">Amount Before Tax <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="number"
                                   [(ngModel)]="assetQuery.amountBeforeTax"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Amount Before Tax" required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">GST Amount <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="number"
                                   [(ngModel)]="assetQuery.gstAmount"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="currentUser.role === 29 ? 'inactive' : ''"
                                   placeholder="GST Amount" required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Additional Expenses <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="number"
                                   [(ngModel)]="assetQuery.additionalExpenses"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Enter Additional Expenses" required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Total Amount <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="number"
                                   [(ngModel)]="assetQuery.totalAmount"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Enter Total Amount" required/>
                        </div>
                        <div class="col-sm-6 form-group" *ngIf="assetQuery.itemsList">
                            <label class="control-label">Quantity <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.itemsList.quantity"
                                   [ngModelOptions]="{standalone: true}"
                                   (ngModelChange)="onQuantityChange()"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29)? 'inactive': ''"
                                   placeholder="Enter Quantity" required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Description <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.description"
                                   [ngModelOptions]="{standalone: true}"
                                   [ngClass]="(currentUser.role === 27 || currentUser.role === 29) ? 'inactive': ''"
                                   placeholder="Enter Descriptions" required/>
                        </div>
                        <div class="col-sm-6">
                            <div class="card" style="width: 18rem; cursor: pointer" (click)="ViewImages(assetQuery)">
                                <div class="card-body">
                                    <img src="/assets/img/icons/emptyIconImage.png" style="width: 100%">
                                    <a class="card-title card-link" style="font-size: 14px">Click Here For Acknowledged Images</a>
                                </div>
                            </div>
                        </div>
                        </div>

                    <div class="row" *ngIf="assetId">
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Select Tax Type<b
                                    class="mandatory-field">*</b></label>
                            <ng-select [(ngModel)]="assetQuery.tax"
                                       [ngModelOptions]="{standalone: true}"
                                       bindValue="value"
                                       bindLabel="key"
                                       placeholder="Select Tax Type"
                                       [clearable]="false"
                                       >
                                <ng-option value="" selected>Select Tax Type</ng-option>
                                <ng-option *ngFor="let ticket of taxArray"
                                           [value]="ticket.value">{{ ticket.key }}
                                </ng-option>
                            </ng-select>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Capitalised Value <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="number"
                                   [(ngModel)]="assetQuery.capitalisedValue"
                                   [ngModelOptions]="{standalone: true}"
                                   placeholder="Enter Capitalised Value" required/>
                        </div>
<!--                        <div class="col-sm-6 form-group">-->
<!--                            <label class="control-label">Date of capitalisation <b-->
<!--                                    class="mandatory-field">*</b></label>-->
<!--                            <input type="text" class="form-control form-control-sm" type="text"-->
<!--                                   [(ngModel)]="assetQuery.dateOfCapitalisation"-->
<!--                                   [ngModelOptions]="{standalone: true}"-->
<!--                                   placeholder="Enter Date of capitalisation " required/>-->
<!--                        </div>-->

                        <div class="col-sm-6 form-group">
                            <label class="control-label">Date of capitalisation <b class="mandatory-field">*</b></label>
                            <div class="input-group">
                                <input class="form-control form-control-sm" placeholder=" Capitalisation Date"
                                       [(ngModel)]="assetQuery.dateOfCapitalisation"
                                       [ngModelOptions]="{standalone: true}"
                                       #dp1="bsDatepicker"
                                       [maxDate]="dateOfCapitalisation"
                                       [minDate]="startExpenseDate"
                                       readonly
                                       [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-red', showTodayButton: true, todayPosition: 'center',  isAnimated: true }"
                                       bsDatepicker required >
                                <div class="input-group-append">
                                    <button class="btn btn-light btn-sm"
                                            style="border: 1px solid #ced4da;"
                                            (click)="dp1.show()"
                                            [attr.aria-expanded]="dp1.isOpen"  >
                                        <i class="fa fa-calendar"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 form-group">
                            <label class="control-label">Model <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.model"
                                   [ngModelOptions]="{standalone: true}"

                                   placeholder="Enter Model " required/>
                        </div>
                        <div class="col-sm-6 form-group">
                            <label class="control-label">Serial Number <b
                                    class="mandatory-field">*</b></label>
                            <input type="text" class="form-control form-control-sm" type="text"
                                   [(ngModel)]="assetQuery.serialNumber"
                                   [ngModelOptions]="{standalone: true}"
                                   placeholder="Enter Serial Number " required/>
                        </div>
                    </div>




<!--                        <div class="row" >-->
<!--                            <div class="col-sm-4" >-->
<!--                                <label class="control-label">Invoice Image</label>-->
<!--                                <div class="card">-->
<!--                                    <img src="{{assetQuery.attrs.assetDocUrl || './assets/img/icons/emptyIconImage.png'}}" alt="Vehicle Image"-->
<!--                                         class="card-img-top" height="168px">-->
<!--                                    <div class="btn-group btn-group-deAndrem" role="group"-->
<!--                                         *ngIf="assetQuery.attrs.assetDocUrl">-->
<!--                                        <button type="button" class="btn btn-sm"-->
<!--                                                (click)="onClick(assetQuery.attrs.assetDocUrl)"-->
<!--                                                data-toggle="modal" data-target="#insuranceUploadModal">-->
<!--                                            <i class="fa fa-info-circle fa-2x"></i>-->
<!--                                        </button>-->
<!--                                        <button type="button" class="btn btn-sm" *ngIf="false">-->
<!--                                            <i class="fa fa-info-circle fa-2x"></i>-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->

<!--                    </div>-->








                    <div class="row mb-4">
                        <div class="col-sm-3 form-group my-auto"
                             *ngFor="let image of imageUrls; let im = index">
                                <label class="control-label">Asset Image - {{im + 1}}</label>
                                <div class="card" style="margin-bottom: 0">
                                    <img alt=" Image"
                                         src="{{image}}"
                                         class="card-img-top"
                                         height="168px">
                                    <div class="btn-group btn-group-deAndrem" role="group">
                                        <button type="button" class="btn btn-sm"
                                                (click)="onClick(image)"
                                                data-toggle="modal" data-target="#insuranceUploadModal">
                                            <i class="fa fa-info-circle fa-2x"></i>
                                        </button>
<!--                                        <ng-template #imageDetailsInfo>-->
<!--                                            <img alt=" Image" src="{{image}}" width="600" height="300px">-->
<!--                                        </ng-template>-->
<!--                                        <button type="button" class="btn btn-sm" (click)="removeUploadImage(image, im)">-->
<!--                                            <i class="fa fa-times-circle fa-2x"></i>-->
<!--                                        </button>-->
                                    </div>
                                </div>
                        </div>
                    </div>

                    <div class="row" *ngIf="!assetId">
                        <div class="col-sm-12 form-group">
                            <table class="table table-hover text-center sticky-invoice">
                                <thead>
                                <tr>
                                    <th>S.No</th>
                                    <th>Serial Number </th>
                                    <th>Model</th>
<!--                                    <th>Actions</th>-->
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="sticky-body" *ngFor="let item of assetQuery.itemsList; let i = index; let last = last;">
                                    <td style="border: 2px solid #dee2e6">
                                        {{ i + 1}}
                                    </td>

                                    <td class="widt-120" style="border: 2px solid #dee2e6">
                                        <input placeholder="Enter Serial Number" type="text"
                                               class="form-control form-control-sm text-right" min="0"
                                               [(ngModel)]="item.serialNumber"
                                               [ngModelOptions]="{standalone: true}" />
                                    </td>
                                    <td class="widt-120" style="border: 2px solid #dee2e6">
                                        <input placeholder="Enter Model" type="text"
                                               class="form-control form-control-sm text-right" min="0"
                                               [(ngModel)]="item.model"
                                               [ngModelOptions]="{standalone: true}" />
                                    </td>
<!--                                    <td style="border: 2px solid #dee2e6">-->
<!--                                        <div style="display: flex" >-->
<!--                                            <button class="action-icon-style waves-effect waves-red delete-user-button"-->
<!--                                                    (click)="deleteItem(i)" title="Delete Item"-->
<!--                                                    *ngIf="assetQuery.itemsList.length != 1"-->
<!--                                                    style="height: 30px;width: 30px;padding: 0;">-->
<!--                                                <i class="fa fa-trash" aria-hidden="true" style="color: red;font-size: 15px"></i>-->
<!--                                            </button>-->

<!--                                            <button class="action-icon-style waves-effect waves-red delete-user-button"-->
<!--                                                    title="Add Item"-->
<!--                                                    style="height: 30px;width: 30px;padding: 0;" (click)="addItem()" *ngIf="last">-->
<!--                                                <i class="fa fa-plus-circle" aria-hidden="true"-->
<!--                                                   style="color: green; font-size: 15px"></i>-->
<!--                                            </button>-->
<!--                                        </div>-->
<!--                                    </td>-->
                                </tr>

                                </tbody>
                                <tfoot>
                                <tr *ngIf="assetQuery.itemsList === null">
                                    <th colspan="6" style="text-align: center">No Records exist.</th>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tile-footer">
                    <div class="row">
                        <div class="col-sm-12 col-sm-offset-3">
                            <div class="alert alert-danger col-sm-12" role="alert" *ngIf="assetErrors.length">
                                <ul style="margin-bottom: 0;">
                                    <li *ngFor="let error of assetErrors">{{error}}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 col-sm-offset-3">
                        <div class="pull-right">
                            <button id="save-client-button"
                                    class="btn btn-sm btn-all-shadow waves-effect waves-light btn-info"
                                    (click)="saveAsset()">
                                <i class="fa fa-fw fa-check-circle"></i>
                                {{currentUser.role === 27 ? 'Confirm' : 'Add Asset'}}
                            </button>
                            &nbsp;&nbsp;&nbsp;
                            <button id="cancel-client-button"
                                    class="btn btn-sm btn-all-shadow waves-effect waves-light btn-dark"
                                    (click)="cancel()">
                                <i class="fa fa-fw fa-times-circle"></i>
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>



<ng-template #myModal2 let-c="close" let-d="dismiss">
    <div class="modal-header">
        <div class="d-none modal-header"></div>
        <img [src]="previewUrl2" style="width: 100%;">
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success btn-sm btn-all-shadow waves-effect waves-light"
                (click)="close()">Close
        </button>&nbsp;&nbsp;&nbsp;
        <a class="btn btn-sm waves-effect waves-light btn-primary"
           href="{{previewUrl2}}">Download</a>
        <!--        <p>{{vehicleMaster.attrs.pollutionUploadUrl || vehicleMaster.attrs.fitnessUploadUrl || vehicleMaster.attrs.insuranceUploadUrl || vehicleMaster.attrs.rcUploadUrl || vehicleMaster.attrs.roadTaxUploadUrl }}</p>-->
    </div>
</ng-template>


<ng-template #viewImageModal class="viewExpensePop" let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h3>View Image</h3>
    </div>
    <div class="modal-body">
            <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item" [ngClass]="i === 0 ? 'active' : ''"
                         *ngFor="let imgData of getAllImages; let i = index;">
                        <b class="carousel-index">
                            {{ i + 1 }}/{{ getAllImages.length }}
                        </b>
<!--                        <button *ngIf="imgData?.imageData?.url" class="btn-sm btn btn-danger delete-button" (click)="deleteImage(i)" style="right: 0;position: absolute;z-index: 1000;">-->
<!--                            <i class="fa fa-times-circle"></i>-->
<!--                        </button>-->

                        <button *ngIf="imgData?.url" class="btn btn-sm btn-success delete-button" (click)="downloadImage(imgData?.url)" style="right: 0;position: absolute;z-index: 1000;">
                            <i class="fa fa-download"></i>
                        </button>
                        <img class="d-block w-100" src="{{ imgData?.url}}" alt="First slide"  />
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
        </div>
    </div>


    <div class="modal-footer">
        <button type="button" class="btn btn-sm waves-effect waves-light btn-secondary" (click)="close()">
            Close
        </button>
    </div>
</ng-template>
